# 手动验收测试 - 故事 1.6：新的开始

## 故事摘要
**作为** 开发者，  
**我希望** 有一个简单的方式在我的宠物死亡后收养新宠物，  
**以便** 我可以重新开始养育体验。

## 验收标准
1. 在IDE命令面板中提供一个命令（例如："Status Pet: Adopt a New Pet"）
2. 命令仅在宠物当前状态为"死亡"时可用
3. 执行命令后，宠物的能量和状态重置为初始的"开心"状态和满能量

---

## 手动测试用例

### 测试用例 1：宠物死亡时命令可用 (验收标准：1, 2)
**测试目标**：验证"收养新宠物"命令仅在宠物死亡时出现在VSCode命令面板中。

**前置条件**：
- 宠物必须处于死亡状态（能量 = 0，表情 = '(x_x)'）
- 加载了扩展的VSCode环境

**测试步骤**：
1. 通过检查状态栏显示 `(x_x) ○○○○○○○○○○ 0.00` 确保宠物已死亡
2. 打开VSCode命令面板（Ctrl+Shift+P / Cmd+Shift+P）
3. 输入"Status Pet"或"Adopt"
4. 查找"Status Pet: Adopt a New Pet"命令

**预期结果**：
- ✅ 命令"Status Pet: Adopt a New Pet"在命令面板中可见
- ✅ 命令可以被选择和执行

**实际结果**：
- [ ] 通过 ✅
- [ ] 失败 ❌ 
- **备注**： 

---

### 测试用例 2：宠物存活时命令不可用 (验收标准：2)
**测试目标**：验证当宠物能量 > 0 时"收养新宠物"命令不可用。

**前置条件**：
- 宠物必须存活（能量 > 0）
- 加载了扩展的VSCode环境

**测试步骤**：
1. 通过检查状态栏显示能量 > 0 确保宠物存活
2. 打开VSCode命令面板（Ctrl+Shift+P / Cmd+Shift+P）
3. 输入"Status Pet"或"Adopt"
4. 查找"Status Pet: Adopt a New Pet"命令

**预期结果**：
- ✅ 命令"Status Pet: Adopt a New Pet"不应该可见或启用
- ✅ 仅显示适用于宠物存活状态的命令

**实际结果**：
- [ ] 通过 ✅
- [ ] 失败 ❌ 
- **备注**： 

---

### 测试用例 3：命令执行后宠物状态重置 (验收标准：3)
**测试目标**：验证执行命令后宠物重置为初始开心状态。

**前置条件**：
- 宠物必须处于死亡状态（能量 = 0）
- 加载了扩展的VSCode环境

**测试步骤**：
1. 验证初始死亡状态：`(x_x) ○○○○○○○○○○ 0.00`
2. 打开命令面板并执行"Status Pet: Adopt a New Pet"
3. 执行后立即检查状态栏
4. 验证 `~/.claude-pet/pet-state.json` 中的宠物文件状态

**预期结果**：
- ✅ 状态栏显示：`(^_^) ●●●●●●●●●● 100.00 (0)`
- ✅ 宠物表情从 `(x_x)` 变为 `(^_^)`
- ✅ 能量条完全填满（100%）
- ✅ 累积token重置为0
- ✅ 出现成功通知（如果VSCode API可用）
- ✅ 宠物状态文件显示能量：100，表情："(^_^)"

**实际结果**：
- [ ] 通过 ✅
- [ ] 失败 ❌ 
- **备注**： 

---

### 测试用例 4：收养后状态持久化 (验收标准：3)
**测试目标**：验证新宠物状态在IDE会话间持久化。

**前置条件**：
- 宠物已成功收养（测试用例3完成）

**测试步骤**：
1. 成功收养后，记录当前状态显示
2. 完全关闭VSCode
3. 在同一项目中重新打开VSCode
4. 检查状态栏显示
5. 验证 `~/.claude-pet/pet-state.json` 中的宠物文件状态

**预期结果**：
- ✅ 状态栏显示：`(^_^) ●●●●●●●●●● 100.00 (0)`（或由于时间衰减略低）
- ✅ 宠物在会话间保持开心状态
- ✅ 能量保持在100%或接近100%
- ✅ 状态文件包含正确的重置值

**实际结果**：
- [ ] 通过 ✅
- [ ] 失败 ❌ 
- **备注**： 

---

### 测试用例 5：CLI模式优雅处理
**测试目标**：验证收养功能在纯CLI模式下正确工作。

**前置条件**：
- 宠物处于死亡状态
- CLI执行环境（VSCode之外）

**测试步骤**：
1. 直接运行CLI：`./dist/ccpet.js` 或 `node dist/ccpet.js`
2. 验证死亡状态输出
3. 注意：CLI模式没有命令面板，所以这测试优雅降级
4. 测试CLI继续正常工作

**预期结果**：
- ✅ CLI显示死亡宠物状态：`(x_x) ○○○○○○○○○○ 0.00`
- ✅ CLI模式无错误或崩溃
- ✅ 宠物状态保持死亡（命令在CLI中不可用）

**实际结果**：
- [ ] 通过 ✅
- [ ] 失败 ❌ 
- **备注**： 

---

### 测试用例 6：错误处理和边缘情况
**测试目标**：验证命令在错误场景下正确表现。

**前置条件**：
- 各种宠物状态和系统条件

**测试步骤**：
1. **文件权限问题**：移除 `~/.claude-pet/` 目录的写权限
2. 执行收养命令
3. **损坏的状态文件**：手动损坏宠物状态JSON文件
4. 执行收养命令
5. **多次快速执行**：快速多次执行收养命令

**预期结果**：
- ✅ 文件权限错误优雅处理（记录日志，不崩溃）
- ✅ 损坏的状态文件导致回退到默认状态
- ✅ 多次执行不会造成竞态条件或重复重置
- ✅ 错误消息有用且不会向用户暴露崩溃

**实际结果**：
- [ ] 通过 ✅
- [ ] 失败 ❌ 
- **备注**： 

---

## 测试总结

**测试执行日期**：`___________`  
**测试员**：`___________`  
**环境**：`___________`  

### 结果摘要：
- **总测试用例数**：6
- **通过**：`___/6`
- **失败**：`___/6`
- **总体结果**：[ ] 通过 ✅ | [ ] 失败 ❌

### 发现的关键问题：
- [ ] 无
- [ ] 列出任何阻止验收的关键问题：

### 次要问题或改进建议：
- [ ] 无  
- [ ] 列出任何次要问题或建议的改进：

### 验收决定：
- [ ] **已验收** - 所有验收标准已满足 ✅
- [ ] **已拒绝** - 关键问题阻止验收 ❌
- [ ] **有条件验收** - 次要问题，可接受后续工作 ⚠️

**QA审查员签名**：`________________` **日期**：`__________`