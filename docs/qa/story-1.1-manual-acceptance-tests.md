# 故事 1.1: Pet First Appearance - 手工验收测试文档

## 测试基本信息

**故事编号**: 1.1  
**故事标题**: Pet First Appearance  
**测试日期**: ___________  
**测试人员**: ___________  
**构建版本**: ___________  

## 前置条件

1. Claude Code CLI 已安装并可正常运行
2. 开发环境具备 Node.js >= 20.0.0 和 npm >= 9.0.0
3. 测试人员熟悉 Claude Code 状态栏配置方法
4. 项目已构建并准备部署状态栏脚本

## 验收标准

根据故事要求，需要验证以下验收标准：

### AC1: Extension installation and activation triggers display of a default ASCII pet and full energy bar in status bar

### AC2: Pet's initial ASCII expression is "happy"

### AC3: Pet display doesn't interfere with or cover other important status bar information

---

## 测试场景

### 场景 1: 状态栏脚本安装和配置

**目标**: 验证状态栏宠物脚本正确安装和配置到Claude Code

#### 测试步骤:

1. **环境准备**
   - [ ] 打开终端并启动Claude Code CLI
   - [ ] 运行 `claude --version` 确认版本
   - [ ] 检查当前状态栏显示（记录初始状态）

2. **构建和安装**
   - [ ] 导航到项目目录 `/Users/nick/CascadeProjects/ccpet`
   - [ ] 运行构建命令: `npm run build`
   - [ ] 验证构建成功，生成 `dist/extension.js`
   - [ ] **预期结果**: 构建无错误，输出文件存在
   - [ ] **实际结果**: ________________

3. **状态栏配置**
   - [ ] 创建或修改 `~/.claude/settings.json`
   - [ ] 添加以下配置内容：
   ```json
   {
     "statusLine": {
       "type": "command",
       "command": "/Users/nick/CascadeProjects/ccpet/dist/extension.js",
       "padding": 0
     }
   }
   ```
   - [ ] 确保脚本路径指向正确的构建输出文件
   - [ ] 验证脚本有执行权限: `chmod +x dist/extension.js`
   - [ ] 重启Claude Code CLI使配置生效
   - [ ] **预期结果**: 配置加载无错误，状态栏显示宠物
   - [ ] **实际结果**: ________________

**验收标准映射**: ✅ AC1 - 安装激活触发显示  
**测试结果**: [ ] ✅ 通过 [ ] ❌ 失败

---

### 场景 2: 初始宠物显示验证

**目标**: 验证宠物在状态栏中正确显示初始状态

#### 测试步骤:

1. **状态栏显示检查**
   - [ ] 观察Claude Code CLI底部状态栏
   - [ ] 定位宠物显示区域
   - [ ] **预期结果**: 看到ASCII宠物显示
   - [ ] **实际结果**: ________________

2. **初始表情验证**
   - [ ] 检查宠物的ASCII表情字符
   - [ ] 验证表情为开心状态
   - [ ] **预期结果**: 显示 `(^_^)` 或类似的开心表情
   - [ ] **实际结果**: ________________

3. **初始能量条验证**
   - [ ] 检查宠物旁边的能量条显示
   - [ ] 验证能量条为满格状态
   - [ ] **预期结果**: 显示满格能量条 `██████████` (10个满格字符)
   - [ ] **实际结果**: ________________

4. **完整格式验证**
   - [ ] 验证完整显示格式
   - [ ] **预期结果**: `(^_^) ██████████` 或相似格式
   - [ ] **实际结果**: ________________

**验收标准映射**: ✅ AC2 - Pet初始表情为happy  
**测试结果**: [ ] ✅ 通过 [ ] ❌ 失败

---

### 场景 3: 状态栏布局和信息显示

**目标**: 验证宠物显示不干扰其他状态栏信息

#### 测试步骤:

1. **状态栏布局检查**
   - [ ] 观察整个状态栏的布局
   - [ ] 检查宠物显示位置（通常在右侧）
   - [ ] **预期结果**: 宠物显示在适当位置，不覆盖其他信息
   - [ ] **实际结果**: ________________

2. **其他信息可见性测试**
   - [ ] 检查模型名称、工作目录等信息是否仍然可见
   - [ ] 在不同长度的路径下测试显示效果
   - [ ] **预期结果**: 所有原有状态栏信息正常显示
   - [ ] **实际结果**: ________________

3. **终端窗口大小测试**
   - [ ] 调整终端窗口大小（缩小、放大）
   - [ ] 观察状态栏在不同窗口大小下的表现
   - [ ] **预期结果**: 宠物显示适应窗口大小，不被截断
   - [ ] **实际结果**: ________________

**验收标准映射**: ✅ AC3 - 不干扰其他状态栏信息  
**测试结果**: [ ] ✅ 通过 [ ] ❌ 失败

---

### 场景 4: 配置生命周期测试

**目标**: 验证配置的启用、禁用和重载行为

#### 测试步骤:

1. **配置禁用测试**
   - [ ] 从 `~/.claude/settings.json` 中移除或注释状态栏配置
   - [ ] 重启Claude Code CLI
   - [ ] **预期结果**: 宠物显示消失，其他状态栏信息正常
   - [ ] **实际结果**: ________________

2. **配置重启测试**
   - [ ] 恢复状态栏配置到 `~/.claude/settings.json`
   - [ ] 重启Claude Code CLI
   - [ ] **预期结果**: 宠物重新显示，状态为初始开心状态
   - [ ] **实际结果**: ________________

3. **配置热重载测试**（如果支持）
   - [ ] 在Claude Code运行时修改配置
   - [ ] 观察状态栏是否自动更新
   - [ ] **预期结果**: 根据Claude Code行为，可能需要重启或自动更新
   - [ ] **实际结果**: ________________

**验收标准映射**: ✅ AC1 - 配置生效行为验证  
**测试结果**: [ ] ✅ 通过 [ ] ❌ 失败

---

### 场景 5: 错误处理和边界情况

**目标**: 验证异常情况下的表现

#### 测试步骤:

1. **脚本文件缺失测试**
   - [ ] 临时移动或重命名构建的脚本文件
   - [ ] 重启Claude Code CLI
   - [ ] **预期结果**: 状态栏优雅处理错误，不崩溃
   - [ ] **实际结果**: ________________

2. **无权限执行测试**
   - [ ] 移除脚本文件的执行权限
   - [ ] 重启Claude Code CLI
   - [ ] **预期结果**: 错误优雅处理，不影响主程序
   - [ ] **实际结果**: ________________

3. **脚本执行错误测试**
   - [ ] 临时修改脚本引入语法错误
   - [ ] 重启Claude Code CLI
   - [ ] **预期结果**: 错误被捕获，不影响主程序稳定性
   - [ ] **实际结果**: ________________

**测试结果**: [ ] ✅ 通过 [ ] ❌ 失败

---

### 场景 6: 性能和响应性验证

**目标**: 验证状态栏宠物对性能的影响

#### 测试步骤:

1. **启动性能测试**
   - [ ] 记录启用宠物前的Claude Code启动时间
   - [ ] 启用宠物后测量启动时间
   - [ ] **预期结果**: 启动时间增加<200ms
   - [ ] **实际结果**: ________________

2. **状态栏更新频率测试**
   - [ ] 观察状态栏更新频率（应为300ms最多更新一次）
   - [ ] 进行持续的对话操作
   - [ ] **预期结果**: 更新频率合理，不过于频繁
   - [ ] **实际结果**: ________________

3. **资源占用测试**
   - [ ] 使用系统监控工具观察内存和CPU使用
   - [ ] 长时间运行后检查资源泄露
   - [ ] **预期结果**: 资源占用最小，无明显泄露
   - [ ] **实际结果**: ________________

**测试结果**: [ ] ✅ 通过 [ ] ❌ 失败

---

## 总体测试结果

### 验收标准完成情况

| 验收标准 | 状态 | 备注 |
|---------|------|------|
| AC1: 配置安装激活触发pet显示 | [ ] ✅ [ ] ❌ | |
| AC2: Pet初始表情为happy | [ ] ✅ [ ] ❌ | |
| AC3: 不干扰其他状态栏信息 | [ ] ✅ [ ] ❌ | |

### 测试场景完成情况

| 测试场景 | 状态 | 备注 |
|---------|------|------|
| 场景1: 脚本安装配置 | [ ] ✅ [ ] ❌ | |
| 场景2: 初始显示验证 | [ ] ✅ [ ] ❌ | |
| 场景3: 布局兼容性 | [ ] ✅ [ ] ❌ | |
| 场景4: 配置生命周期 | [ ] ✅ [ ] ❌ | |
| 场景5: 错误处理 | [ ] ✅ [ ] ❌ | |
| 场景6: 性能验证 | [ ] ✅ [ ] ❌ | |

### 配置参考

#### 示例 `~/.claude/settings.json` 配置

```json
{
  "statusLine": {
    "type": "command", 
    "command": "/Users/nick/CascadeProjects/ccpet/dist/extension.js",
    "padding": 0
  }
}
```

**重要提示**: 
- 请将 `command` 路径替换为您实际的项目路径
- 确保脚本有执行权限: `chmod +x dist/extension.js`
- 路径必须是绝对路径，不能使用 `~` 或相对路径

#### 替代配置方法

使用 `/statusline` 命令进行交互式配置：

```bash
claude-code
> /statusline
# 按照提示配置状态栏宠物显示
```

### 缺陷记录

| 缺陷ID | 严重程度 | 描述 | 状态 |
|-------|---------|------|------|
| | | | |

### 最终测试结论

- [ ] **✅ 接受** - 所有验收标准通过，故事可以发布
- [ ] **❌ 拒绝** - 存在阻塞性问题，需要修复后重新测试  
- [ ] **⚠️ 有条件接受** - 存在非阻塞性问题，可以发布但需要跟进

**测试人员签名**: ___________________  
**测试完成日期**: _________________

---

## 附录

### 相关文档

- Claude Code 状态栏文档: https://docs.anthropic.com/en/docs/claude-code/statusline
- 故事文档: `docs/stories/1.1.pet-first-appearance.md`
- PRD文档: `docs/prd.md`

### 技术参考

- 构建命令: `npm run build`
- 测试命令: `npm test`
- 配置文件位置: `~/.claude/settings.json`

### 联系信息

- 开发团队: [开发者联系方式]
- QA负责人: [QA负责人联系方式]